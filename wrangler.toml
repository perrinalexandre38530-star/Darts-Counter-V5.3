# =============================================
# wrangler.toml — Worker ONLINE + Sync Cloud
# - Durable Object "RoomDO" pour les salons
# - KV AVATAR_CACHE (cache avatars IA)
# - KV DC_SYNC pour les snapshots de stats
# - CORS ALLOW_ORIGINS à adapter
# =============================================

name = "darts-online"
main = "src/online/server/worker.ts"
compatibility_date = "2024-11-15"

# ✅ Active le support WebSocket / DO / Node
compatibility_flags = ["nodejs_compat"]

[durable_objects]
bindings = [
  { name = "ROOMS", class_name = "RoomDO" }
]

[[migrations]]
tag = "v1"
new_classes = ["RoomDO"]

# ➕ KV pour le cache des avatars IA (existant)
[[kv_namespaces]]
binding = "AVATAR_CACHE"
id = "65729b90e2d44fbe90db28bda837cd63"

# ➕ KV pour la synchronisation Cloud des stats (dc-sync)
[[kv_namespaces]]
binding = "DC_SYNC"
id = "96adf0e2754949f88153f796c053d2cef"

[vars]
# ➜ Front : ton Pages + ton dev local
ALLOW_ORIGINS = "http://localhost:5173,https://darts-counter-v5-3.pages.dev"
