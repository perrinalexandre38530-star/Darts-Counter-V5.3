# =============================================
# wrangler.toml â€” Worker ONLINE + Sync Cloud + Dart Scanner
# =============================================

name = "darts-online"
main = "src/online/server/worker.ts"
compatibility_date = "2024-11-15"

# âœ… Active le support WebSocket / DO / Node
compatibility_flags = ["nodejs_compat"]

[durable_objects]
bindings = [
  { name = "ROOMS", class_name = "RoomDO" }
]

[[migrations]]
tag = "v1"
new_classes = ["RoomDO"]

# âž• KV pour le cache des avatars IA (existant)
[[kv_namespaces]]
binding = "AVATAR_CACHE"
id = "65729b90e2d44fbe90db28bda837cd63"

# âž• KV pour la synchronisation Cloud des stats (dc-sync)
[[kv_namespaces]]
binding = "DC_SYNC"
id = "96adf0e2754949f88153f796c053d2cef"

# ðŸ”¹ Variables d'environnement (UN SEUL bloc [vars] !)
[vars]
# âžœ Front : ton Pages + ton dev local
ALLOW_ORIGINS = "http://localhost:5173,https://darts-counter-v5-3.pages.dev"

# âžœ Base publique de ton bucket R2 pour les images de flÃ©chettes
PUBLIC_BASE_URL = "https://pub-170ceab787594ee9a09d6315358fb928.r2.dev"

# ðŸ”¥ Ton bucket R2 rÃ©el
[[r2_buckets]]
binding = "DART_IMAGES_BUCKET"
bucket_name = "dart-scans"

# ðŸ”¹ Workers AI
[ai]
binding = "AI"
